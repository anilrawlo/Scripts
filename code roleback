---
- name: Rollback files on the target servers
  hosts: target_servers
  become: yes
  tasks:
    - name: Read the CSV file
      community.general.read_csv:
        path: "/path/to/your/file.csv"  # Directly specify the CSV file path
        key: "filename"
      register: csv_data

    - name: Rollback files
      loop: "{{ csv_data.list }}"
      vars:
        file_name: "{{ item.filename }}"
        destination_path: "{{ item.destination }}"
        permissions: "{{ item.permission }}"
        original_file_path: "{{ destination_path }}{{ file_name }}"
        backup_file_path: "/opt/jboss/deployment_backup{{ original_file_path }}"  # Backup directory
      tasks:
        - name: Restore file from backup
          ansible.builtin.copy:
            src: "{{ backup_file_path }}"
            dest: "{{ original_file_path }}"
            remote_src: yes

        - name: Set file permissions
          ansible.builtin.file:
            path: "{{ original_file_path }}"
            mode: "{{ permissions }}"